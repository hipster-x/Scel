# Практическая работа №4 Network Threat Hunting

Выполнил студент ББМО-02-23 Евдокимов А.М.

## Скачиваем и разворачиваем стенд

![Desktop Screenshot 2024 12 01 - 13 55 34 31](https://github.com/user-attachments/assets/e267b5be-1451-4bb7-8861-452a4b9c7404)

Логинимся

![Desktop Screenshot 2024 12 01 - 14 07 57 32](https://github.com/user-attachments/assets/31c80cc9-1e0e-4c93-a9cb-0a357a326eab)

Добавляем адрес с траффиком к skype.com в safelist, как сказано в руководстве

![Desktop Screenshot 2024 12 01 - 14 07 21 30](https://github.com/user-attachments/assets/321e041c-d6e7-4681-9912-df570affe610)

![Desktop Screenshot 2024 12 01 - 14 22 23 47](https://github.com/user-attachments/assets/8d255d7e-51c5-446f-a4ae-1a38c6ccd560)

![Desktop Screenshot 2024 12 01 - 14 26 07 37](https://github.com/user-attachments/assets/489333d4-7015-4229-8dc4-be6c02b4e664)

Конечный safelist

![Desktop Screenshot 2024 12 01 - 14 26 54 21](https://github.com/user-attachments/assets/44c945e0-0824-47af-bd87-18842ddaf033)

## Lab 1

Импортируем логи и переключаемся на них в стенде

![Desktop Screenshot 2024 12 01 - 14 20 47 59](https://github.com/user-attachments/assets/5579f614-c139-4875-ae94-fd11dd4127ce)

Выбираем нужный Database

![Desktop Screenshot 2024 12 01 - 14 27 20 84](https://github.com/user-attachments/assets/6561c7c7-1af9-4ffb-b55b-f8bc68881cb7)

Переходим в модуль beacon web и анализируем 

![Desktop Screenshot 2024 12 01 - 14 29 00 65](https://github.com/user-attachments/assets/4a66736a-c065-4142-bba8-70c28c775f94)

![Desktop Screenshot 2024 12 01 - 14 30 02 85](https://github.com/user-attachments/assets/c3f7e125-18a6-475d-97cb-4201f63953cc)

Анализ всех адресов показал, что - 

Высокий уровень согласованности метрик (99.70%):

Такая высокая согласованность (cumulative metric conformity) может свидетельствовать о регулярных, четко упорядоченных запросах от источника к целевому IP-адресу. 
Это может быть признаком Beaconing-а, когда зараженное устройство связывается с управляющим сервером (C2).

Общее количество соединений (3011):

Для одного IP-адреса это значительное количество соединений. Если это типично для сети, возможно, это не аномалия. Но если такая активность не ожидается (например, для обычного пользователя или устройства IoT), это может указывать на нежелательное поведение.
Равномерное распределение активности на графике:

Использование HTTP без шифрования:

Отсутствие HTTPS может означать, что данные передаются в незашифрованном виде, что рискованно. Для связи с C2-серверами часто используются такие незащищенные протоколы.

Практически все адреса связаны с Windows, так что добавляем их в safelist

Конечный safelist

![Desktop Screenshot 2024 12 01 - 14 34 08 05](https://github.com/user-attachments/assets/c1f2f4d5-a732-4a37-939f-57b4d9262744)

Перейдём в модуль длительных соединений

![Desktop Screenshot 2024 12 01 - 14 35 56 73](https://github.com/user-attachments/assets/791cfa0e-62b0-4949-9427-5fb44ee70b23)

Всего 2 адресса, проверим их через VirusTotal

![Desktop Screenshot 2024 12 01 - 14 39 36 01](https://github.com/user-attachments/assets/75b12901-9f43-42b3-8d81-7bd90363fc86)

![Desktop Screenshot 2024 12 01 - 14 39 41 20](https://github.com/user-attachments/assets/dc133526-f8e2-4a37-b226-7788b7cde088)

VirusTotal пометил один из адресов, как вредоносный.

Подозрительная природа доменов
Связанные с IP домены `piensorcad6302755c.aiihosted.com` и `demo1.aiihosted.com` выглядят подозрительно:
Длинные, автоматически сгенерированные имена часто используются злоумышленниками для маскировки.
Домены связаны с поддоменами `aiihosted.com`, что может указывать на временную инфраструктуру (например, для фишинга, C2 или ботнетов).

Связь с DigitalOcean
Этот IP принадлежит хостинг-провайдеру `DigitalOcean`, который, как и другие публичные облачные провайдеры, часто используется для легальных целей. Однако злоумышленники также арендуют облачные серверы для вредоносной активности, таких как:
Развёртывание C2-серверов.
Проведение атак (например, DDoS, фишинг).

Связь с файлом `"7May2021_export_bookmark.html"`:
Хотя файл не был помечен как вредоносный, сама его природа (экспорт закладок) может намекать на использование IP для передачи данных, что требует дополнительного анализа.

## Lab 2

Импортируем логи и переключаемся на них.

![Desktop Screenshot 2024 12 01 - 14 39 41 20](https://github.com/user-attachments/assets/d7a92e5b-7ac0-49de-8355-8c2b80c6c2e8)

На основной странице пусто, но система отсылается к модулю DNS, убираем фильтры

![Desktop Screenshot 2024 12 01 - 14 45 40 51](https://github.com/user-attachments/assets/b78f6d15-d7eb-4eb9-9ea7-a7f144393d23)

Подозрительный домен: `honestimnotevil.com`
Название домена вызывает подозрения из-за своей провокационной природы ("честно, я не злой"), что может быть попыткой злоумышленников замаскировать свои намерения.
Такие имена доменов часто используют в тестовых или вредоносных инфраструктурах.

Большое количество запросов (2074 запросов)
Это аномальное количество DNS-запросов к одному домену, что может свидетельствовать о:
Подключении к Command & Control серверу.
Вредоносной программе, регулярно обращающейся к этому домену.

Длинные поддомены

Например:
`...b7f9090b8e40bac43eb80a.honestimnotevil.com`
`...291b4324545e080e82a0ea.honestimnotevil.com`

Длинные, случайно сгенерированные поддомены часто используются в доменной генерации (DGA — Domain Generation Algorithm), которая характерна для вредоносных программ.
Каждый новый поддомен может быть связан с уникальной сессией или устройством, участвующим в ботнете.

Связь с единственным хостом: `172.21.8.157`
Все запросы направлены на один IP-адрес (172.21.8.157).
Это может быть внутренний сервер или прокси для перенаправления запросов, но такой концентрации трафика стоит уделить внимание.

Нет прямых соединений (Direct Connections = 0)
Указано, что прямые соединения отсутствуют, что говорит о том, что злоумышленники могут использовать DNS-туннелирование для передачи данных через DNS-запросы.
Что меня смущает:
DNS-туннелирование или C2-активность

Количество запросов и странные поддомены сильно указывают на DNS-туннелирование или связь с Command & Control сервером.
DGA (Domain Generation Algorithm)

Автоматически сгенерированные поддомены и подозрительный основной домен усиливают вероятность того, что это вредоносная инфраструктура.
Аномальная активность в сети

Если это единственный хост (172.21.8.157), отправляющий такие запросы, он может быть скомпрометированным устройством.

## Lab 3 

![Desktop Screenshot 2024 12 01 - 14 46 27 68](https://github.com/user-attachments/assets/c1b48a56-a203-4651-9a9a-b7174f5ba605)

![Desktop Screenshot 2024 12 01 - 14 50 20 30](https://github.com/user-attachments/assets/4b941fb7-990a-4c1d-9ce0-306eb55b0e01)

Переходим в модуль beacons web

![Desktop Screenshot 2024 12 01 - 14 51 07 01](https://github.com/user-attachments/assets/66500f76-7a20-4ccf-ba29-45cf256b4f50)

Анализируем адреса и вносим легитивные в safelist

![Desktop Screenshot 2024 12 01 - 14 51 39 36](https://github.com/user-attachments/assets/a25e4442-edb6-4bc3-87df-fb20cd8d1033)

Остается всего два адреса, проверим каждый через VirusTotal

![Desktop Screenshot 2024 12 01 - 14 52 24 04](https://github.com/user-attachments/assets/6fe8e36a-4607-4eeb-b4c7-d80a0abe12f6)

Связь с вредоносной активностью

Метка DGA и упоминание Cobalt Strike усиливают подозрения, что домен используется для управления вредоносной активностью.
Количество детекций

Пять независимых сервисов отметили домен как вредоносный, что повышает вероятность его использования в атаках.
Неопределённость IP-адреса

`IP 210.71.232.11` необходимо анализировать отдельно. Если он используется несколькими подозрительными доменами, это усилит подозрения.
Свежесть данных

Анализ проводился месяц назад, что недостаточно актуально для оценки текущей активности домена.

